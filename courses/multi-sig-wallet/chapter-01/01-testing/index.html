<!DOCTYPE html><html data-react-helmet="lang" lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#000000" name="theme-color"><link href="/manifest.json" rel="manifest"><link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"><title>Build a Multi-Sig Wallet in Solidity | Smart Contract Programmer</title><script src="https://www.google-analytics.com/analytics.js" async type="text/javascript"></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-137197383-1" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-137197383-1")</script><link href="https://maxcdn.bootstrapcdn.com" rel="preconnect"><link href="https://www.googletagmanager.com" rel="preconnect"><link href="/static/css/2.873dbdc4.chunk.css" rel="stylesheet"><link href="/static/css/main.b7743d32.chunk.css" rel="stylesheet"><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://fonts.googleapis.com" rel="preconnect"><meta content="Learn how to program smart contracts." data-react-helmet="true" name="description"><meta content="Build a Multi-Sig Wallet in Solidity | Smart Contract Programmer" data-react-helmet="true" property="og:title"><meta content="Learn how to program smart contracts." data-react-helmet="true" property="og:description"><meta content="website" data-react-helmet="true" property="og:type"><meta content="smart contract, solidity, ethereum" data-react-helmet="true" name="keywords"><link href="https://www.youtube-nocookie.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://s.ytimg.com" rel="preconnect"><link href="https://yt3.ggpht.com" rel="preconnect"><link href="https://i.ytimg.com" rel="preconnect"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="PageLayout_PageLayout__xka-l" id="top"><div class="ui large borderless fluid inverted top fixed menu" style="background-color:#20232a"><a href="/#top" class="header item" style="padding:0;width:300px"><img alt="logo" class="ui image" src="/static/media/logo.cae6ce4a.svg" style="height:48px;background-color:#20232a;margin:5px;border-radius:4px">Smart Contract Programmer</a><div class="right menu"><a href="/#courses" class="item">Courses</a><a href="/#about" class="item">About</a><a href="/#contact" class="item">Contact</a></div></div><div style="padding-bottom:58px"></div><div class="PageLayout_main__3Oesk"><div class="LessonLayout_component__2_D0o"><div class="LessonLayout_row__1gYJU"><div class="SideNav_component__1n9vJ"><div class="SideNav_sideNav__1ZDpT"><a href="/courses/multi-sig-wallet" class="SideNav_overviewLink__L4iqf"><i aria-hidden="true" class="chevron left icon"></i><div>Coarse</div></a><div class="ui divider"></div><div><h2 class="SideNav_header__3cV8w">Solidity Contract</h2><div class="ui divided selection relaxed list" role="list"><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/00-intro" class="header">Intro</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/01-constructor-exercise" class="header">Constructor</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/01-constructor-solution" class="header">Constructor</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/02-fallback-exercise" class="header">Fallback</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/02-fallback-solution" class="header">Fallback</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/03-submit-transaction-exercise" class="header">Submit Transaction</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/03-submit-transaction-solution" class="header">Submit Transaction</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/04-confirm-transaction-exercise" class="header">Confirm Transaction</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/04-confirm-transaction-solution" class="header">Confirm Transaction</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/05-execute-transaction-exercise" class="header">Execute Transaction</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/05-execute-transaction-solution" class="header">Execute Transaction</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/06-revoke-confirmation-exercise" class="header">Revoke Confirmation</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/06-revoke-confirmation-solution" class="header">Revoke Transaction</a><div class="description">Solution</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/07-demo" class="header">Demo</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black github large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-00/08-code" class="header">Code</a></div></div></div></div><div><h2 class="SideNav_header__3cV8w">Truffle</h2><div class="ui divided selection relaxed list" role="list"><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-01/00-setup" class="header">Setup</a></div></div><div class="active item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-01/01-testing" class="header">Testing</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-01/02-migration" class="header">Migration</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-01/03-metamask" class="header">Metamask</a></div></div></div></div><div><h2 class="SideNav_header__3cV8w">React TypeScript</h2><div class="ui divided selection relaxed list" role="list"><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-02/00-overview" class="header">Overview</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-02/01-setup" class="header">Install and Setup React</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="red youtube large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-02/02-web3-context" class="header">Web3 Context</a></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black code large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-02/03-exercise-monitor-network" class="header">Monitor Network</a><div class="description">Exercise</div></div></div><div class="item" role="listitem"><i aria-hidden="true" class="black github large icon middle aligned"></i><div class="content"><a href="/courses/multi-sig-wallet/chapter-02/08-code" class="header">Code</a></div></div></div></div></div></div><div class="LessonLayout_main__3WQRn"><div class="ui container"><div class="LessonLayout_youTube__72FY7"><div class="YouTube_component__1KLr6"><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen frameborder="0" height="500" src="https://www.youtube-nocookie.com/embed/XFQgY-lNNlE" title="Truffle Testing - Multi Sig Wallet" width="889"></iframe></div></div><div><h3 id="testing">Testing</h3><p>Your truffle project should look similar to this</p><pre><code class="language-shell hljs">solidity-multi-sig-wallet
├── contracts
├── migrations
├── package.json
├── package-lock.json
├── test
└── truffle-config.js</code></pre><p>Inside <code>test</code> folder, create your test.</p><p>Here is the test that we wrote in the video.</p><pre><code class="language-javascript hljs"><span class="hljs-keyword">const</span> chai = <span class="hljs-built_in">require</span>(<span class="hljs-string">"chai"</span>)
chai.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">"chai-as-promised"</span>))

<span class="hljs-keyword">const</span> expect = chai.expect

<span class="hljs-keyword">const</span> MultiSigWallet = artifacts.require(<span class="hljs-string">"MultiSigWallet"</span>)

contract(<span class="hljs-string">"MultiSigWallet"</span>, (accounts) => {
  <span class="hljs-keyword">const</span> owners = [accounts[<span class="hljs-number">0</span>], accounts[<span class="hljs-number">1</span>], accounts[<span class="hljs-number">2</span>]]
  <span class="hljs-keyword">const</span> NUM_CONFIRMATIONS_REQUIRED = <span class="hljs-number">2</span>

  <span class="hljs-keyword">let</span> wallet
  beforeEach(<span class="hljs-keyword">async</span> () => {
    wallet = <span class="hljs-keyword">await</span> MultiSigWallet.new(owners, NUM_CONFIRMATIONS_REQUIRED)
  })

  describe(<span class="hljs-string">"executeTransaction"</span>, () => {
    beforeEach(<span class="hljs-keyword">async</span> () => {
      <span class="hljs-keyword">const</span> to = owners[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">const</span> value = <span class="hljs-number">0</span>
      <span class="hljs-keyword">const</span> data = <span class="hljs-string">"0x0"</span>

      <span class="hljs-keyword">await</span> wallet.submitTransaction(to, value, data)
      <span class="hljs-keyword">await</span> wallet.confirmTransaction(<span class="hljs-number">0</span>, { <span class="hljs-attr">from</span>: owners[<span class="hljs-number">0</span>] })
      <span class="hljs-keyword">await</span> wallet.confirmTransaction(<span class="hljs-number">0</span>, { <span class="hljs-attr">from</span>: owners[<span class="hljs-number">1</span>] })
    })

    <span class="hljs-comment">// execute transaction should succeed</span>
    it(<span class="hljs-string">"should execute"</span>, <span class="hljs-keyword">async</span> () => {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> wallet.executeTransaction(<span class="hljs-number">0</span>, { <span class="hljs-attr">from</span>: owners[<span class="hljs-number">0</span>] })
      <span class="hljs-keyword">const</span> { logs } = res

      assert.equal(logs[<span class="hljs-number">0</span>].event, <span class="hljs-string">"ExecuteTransaction"</span>)
      assert.equal(logs[<span class="hljs-number">0</span>].args.owner, owners[<span class="hljs-number">0</span>])
      assert.equal(logs[<span class="hljs-number">0</span>].args.txIndex, <span class="hljs-number">0</span>)

      <span class="hljs-keyword">const</span> tx = <span class="hljs-keyword">await</span> wallet.getTransaction(<span class="hljs-number">0</span>)
      assert.equal(tx.executed, <span class="hljs-literal">true</span>)
    })

    <span class="hljs-comment">// execute transaction should fail if already executed</span>
    it(<span class="hljs-string">"should reject if already executed"</span>, <span class="hljs-keyword">async</span> () => {
      <span class="hljs-keyword">await</span> wallet.executeTransaction(<span class="hljs-number">0</span>, { <span class="hljs-attr">from</span>: owners[<span class="hljs-number">0</span>] })

      <span class="hljs-comment">/*
      try {
        await wallet.executeTransaction(0, { from: owners[0] })
        throw new Error("tx did not fail")
      } catch (error) {
        assert.equal(error.reason, "tx already executed")
      }
      */</span>

      <span class="hljs-keyword">await</span> expect(wallet.executeTransaction(<span class="hljs-number">0</span>, { <span class="hljs-attr">from</span>: owners[<span class="hljs-number">0</span>] })).to.be
        .rejected
    })
  })
})</code></pre><p>Run the test by typing</p><pre><code class="language-shell hljs">truffle test</code></pre><p>Code for the test is <a href="https://github.com/t4sk/solidity-multi-sig-wallet/blob/master/test/multi-sig-wallet.js" target="__blank" alt="code">here</a></p></div><div class="LessonLayout_buttons__22__X"><a href="/courses/multi-sig-wallet/chapter-01/00-setup" class="ui huge animated button" role="button"><div class="visible content">Back</div><div class="hidden content"><i aria-hidden="true" class="arrow left icon"></i></div></a><a href="/courses/multi-sig-wallet/chapter-01/02-migration" class="ui huge animated button" role="button"><div class="visible content">Next</div><div class="hidden content"><i aria-hidden="true" class="arrow right icon"></i></div></a></div></div></div></div></div></div><div style="padding:50px"></div><div class="Footer_component__2wm-B"><div class="ui container"><div class="Footer_row__3cluQ"><img alt="license" class="ui image" src="/static/media/creative-commons-logo.60ebfa35.svg" style="height:20px;margin:10px"><a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="Footer_link__1NGbN" target="__blank">Creative Commons CC BY-SA 3.0</a></div></div></div></div></div><script>!function(r){function e(e){for(var n,a,l=e[0],c=e[1],p=e[2],i=0,s=[];i<l.length;i++)a=l[i],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&s.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(r[n]=c[n]);for(f&&f(e);s.length;)s.shift()();return u.push.apply(u,p||[]),t()}function t(){for(var r,e=0;e<u.length;e++){for(var t=u[e],n=!0,l=1;l<t.length;l++){var c=t[l];0!==o[c]&&(n=!1)}n&&(u.splice(e--,1),r=a(a.s=t[0]))}return r}var n={},o={1:0},u=[];function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=r,a.c=n,a.d=function(r,e,t){a.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},a.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},a.t=function(r,e){if(1&e&&(r=a(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)a.d(t,n,function(e){return r[e]}.bind(null,n));return t},a.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return a.d(e,"a",e),e},a.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},a.p="/";var l=this["webpackJsonpsmart-contract-programmer"]=this["webpackJsonpsmart-contract-programmer"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var p=0;p<l.length;p++)e(l[p]);var f=c;t()}([])</script><script src="/static/js/2.9b465b5e.chunk.js"></script><script src="/static/js/main.265b565d.chunk.js"></script></body></html>